(window.webpackJsonp=window.webpackJsonp||[]).push([[35],{320:function(s,a,t){"use strict";t.r(a);var e=t(14),n=Object(e.a)({},(function(){var s=this,a=s._self._c;return a("ContentSlotsDistributor",{attrs:{"slot-key":s.$parent.slotKey}},[a("h2",{attrs:{id:"mail-without-sql-agent"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#mail-without-sql-agent"}},[s._v("#")]),s._v(" Mail without SQL Agent")]),s._v(" "),a("p",[s._v("While SQL Server Express is still 100% able to send mail using msdb's stored procedures,\nmost people rely on Management Studio's GUI and the Database Mail feature to do the initial setup of profiles and accounts\nto make sending mail possible. Despite this limitation, the underlying stored procedures located within the msdb database are still fully able to replication the GUI driven setup that Database Mail aids in. This leaves T-SQL as the primary alternative for enabling and configuring SQL Server Express so that "),a("code",[s._v("sp_send_dbmail")]),s._v(" can be used to send mail out. Adding this functionality with a "),a("RouterLink",{attrs:{to:"/sql-server-express-replace-sql-agent.html"}},[s._v("replacement for SQL Agent")]),s._v(" can help mimic much of the functionality that Database Mail and SQL Agent provide on the full featured editions of SQL Server.")],1),s._v(" "),a("p",[a("img",{attrs:{src:"/database_mail.png",alt:"SQL Server Mail in non-Express Editions"}})]),s._v(" "),a("p",[a("em",[s._v("The Database Mail feature as seen in other SQL Server editions.")])]),s._v(" "),a("p",[s._v("While a CLR can also be used to send mail, that route is far more work and increases the complexity of\nsending mail via SQL Server quite a bit. This requires enabling CLRs, which is disabled by default. Enabling CLRs opens the instance up to external code, which may be a security or audit concern and is often allowed in many corporate environments.")]),s._v(" "),a("h2",{attrs:{id:"setting-up-mail-on-sql-server-express"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#setting-up-mail-on-sql-server-express"}},[s._v("#")]),s._v(" Setting up Mail on SQL Server Express")]),s._v(" "),a("p",[s._v("The below code sample demonstrates the entire process of setting up mail on SQL Server Express,\nincluding sending a test email at the end.")]),s._v(" "),a("div",{staticClass:"custom-block warning"},[a("p",{staticClass:"custom-block-title"},[s._v("WARNING")]),s._v(" "),a("p",[s._v("Utilizing the database mail on SQL Server Express Edition may violate the license agreement. Check with Microsoft before implementing this in a production environment.")])]),s._v(" "),a("p",[s._v("The setup will:")]),s._v(" "),a("ol",[a("li",[s._v("Create a mail account")]),s._v(" "),a("li",[s._v("Create a mail profile")]),s._v(" "),a("li",[s._v("Add the account to the profile")]),s._v(" "),a("li",[s._v("Add permission to use the profile for a user or role")]),s._v(" "),a("li",[s._v("Enable database mail XPs")]),s._v(" "),a("li",[s._v("Send a test email")])]),s._v(" "),a("p",[s._v("The stored procedures required are:")]),s._v(" "),a("ul",[a("li",[a("a",{attrs:{href:"https://docs.microsoft.com/en-us/sql/relational-databases/system-stored-procedures/sysmail-add-account-sp-transact-sql?view=sql-server-2017",target:"_blank",rel:"noopener noreferrer"}},[s._v("sysmail_add_account_sp"),a("OutboundLink")],1)]),s._v(" "),a("li",[a("a",{attrs:{href:"https://docs.microsoft.com/en-us/sql/relational-databases/system-stored-procedures/sysmail-add-profile-sp-transact-sql?view=sql-server-2017",target:"_blank",rel:"noopener noreferrer"}},[s._v("sysmail_add_profile_sp"),a("OutboundLink")],1)]),s._v(" "),a("li",[a("a",{attrs:{href:"https://docs.microsoft.com/en-us/sql/relational-databases/system-stored-procedures/sysmail-add-profileaccount-sp-transact-sql?view=sql-server-2017",target:"_blank",rel:"noopener noreferrer"}},[s._v("sysmail_add_profileaccount_sp"),a("OutboundLink")],1)]),s._v(" "),a("li",[a("a",{attrs:{href:"https://docs.microsoft.com/en-us/sql/relational-databases/system-stored-procedures/sysmail-add-principalprofile-sp-transact-sql?view=sql-server-2017",target:"_blank",rel:"noopener noreferrer"}},[s._v("sysmail_add_principalprofile_sp"),a("OutboundLink")],1)]),s._v(" "),a("li",[a("a",{attrs:{href:"https://docs.microsoft.com/en-us/sql/relational-databases/system-stored-procedures/sp-configure-transact-sql?view=sql-server-2017",target:"_blank",rel:"noopener noreferrer"}},[s._v("sp_configure"),a("OutboundLink")],1)]),s._v(" "),a("li",[a("a",{attrs:{href:"https://docs.microsoft.com/en-us/sql/relational-databases/system-stored-procedures/sp-send-dbmail-transact-sql?view=sql-server-2017",target:"_blank",rel:"noopener noreferrer"}},[s._v("sp_send_dbmail"),a("OutboundLink")],1)])]),s._v(" "),a("h3",{attrs:{id:"the-code"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#the-code"}},[s._v("#")]),s._v(" The Code")]),s._v(" "),a("div",{staticClass:"language-sql line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-sql"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("/* Create a mail account */")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("EXECUTE")]),s._v(" msdb"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("dbo"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("sysmail_add_account_sp\n"),a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("@account_name")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'MyMailAccount'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("@description")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'Used for sending email from SQL Express'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("--Name of sending email address")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("@email_address")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'MyExpressDB@mycompany.com'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("--Display name for the sending email address")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("@display_name")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'MyExpressDB'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("--Username to login to the mail server")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("@username")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'MyMailUser@mycompany.com'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("--Password to login to the mail server")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("@password")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'MyPassword'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("--Name or IP of the mail server")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("@mailserver_name")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'mail.queryingsql.com'")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("--Default is 25, or specify a custom one")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("@port")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("25")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("/* Create a profile */")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("EXECUTE")]),s._v(" msdb"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("dbo"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("sysmail_add_profile_sp\n"),a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("@profile_name")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'MyMailProfile'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("@description")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'Main profile used to send email'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("/* Add the account to the profile */")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("EXECUTE")]),s._v(" msdb"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("dbo"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("sysmail_add_profileaccount_sp\n"),a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("@profile_name")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'MyMailProfile'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("@account_name")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'MyMailAccount'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("/* The sequence number determines the order\nin which Database Mail uses accounts in the profile,\ngoing from lowest to highest until one works. */")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("@sequence_number")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("/* Grant permission to public to use the profile\nor choose a more restrictive group if desired */")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("EXECUTE")]),s._v(" msdb"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("dbo"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("sysmail_add_principalprofile_sp\n"),a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("@profile_name")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'MyMailProfile'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("@principal_name")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'public'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("@is_default")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("/* Enable Mail XPs */")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("EXECUTE")]),s._v(" sp_configure "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'show advanced options'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\nGO\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("RECONFIGURE")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\nGO\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("EXECUTE")]),s._v(" sp_configure "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'Database Mail XPs'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\nGO\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("RECONFIGURE")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\nGO\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("/* Send a test email */")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("EXECUTE")]),s._v(" msdb"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("dbo"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("sp_send_dbmail\n"),a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("@profile_name")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'MyMailProfile'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("@recipients")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'MyTestAddress@mycompany.com'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("@subject")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'Test Mail from SQL Express'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("@body")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'Hello world!'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br"),a("span",{staticClass:"line-number"},[s._v("12")]),a("br"),a("span",{staticClass:"line-number"},[s._v("13")]),a("br"),a("span",{staticClass:"line-number"},[s._v("14")]),a("br"),a("span",{staticClass:"line-number"},[s._v("15")]),a("br"),a("span",{staticClass:"line-number"},[s._v("16")]),a("br"),a("span",{staticClass:"line-number"},[s._v("17")]),a("br"),a("span",{staticClass:"line-number"},[s._v("18")]),a("br"),a("span",{staticClass:"line-number"},[s._v("19")]),a("br"),a("span",{staticClass:"line-number"},[s._v("20")]),a("br"),a("span",{staticClass:"line-number"},[s._v("21")]),a("br"),a("span",{staticClass:"line-number"},[s._v("22")]),a("br"),a("span",{staticClass:"line-number"},[s._v("23")]),a("br"),a("span",{staticClass:"line-number"},[s._v("24")]),a("br"),a("span",{staticClass:"line-number"},[s._v("25")]),a("br"),a("span",{staticClass:"line-number"},[s._v("26")]),a("br"),a("span",{staticClass:"line-number"},[s._v("27")]),a("br"),a("span",{staticClass:"line-number"},[s._v("28")]),a("br"),a("span",{staticClass:"line-number"},[s._v("29")]),a("br"),a("span",{staticClass:"line-number"},[s._v("30")]),a("br"),a("span",{staticClass:"line-number"},[s._v("31")]),a("br"),a("span",{staticClass:"line-number"},[s._v("32")]),a("br"),a("span",{staticClass:"line-number"},[s._v("33")]),a("br"),a("span",{staticClass:"line-number"},[s._v("34")]),a("br"),a("span",{staticClass:"line-number"},[s._v("35")]),a("br"),a("span",{staticClass:"line-number"},[s._v("36")]),a("br"),a("span",{staticClass:"line-number"},[s._v("37")]),a("br"),a("span",{staticClass:"line-number"},[s._v("38")]),a("br"),a("span",{staticClass:"line-number"},[s._v("39")]),a("br"),a("span",{staticClass:"line-number"},[s._v("40")]),a("br"),a("span",{staticClass:"line-number"},[s._v("41")]),a("br"),a("span",{staticClass:"line-number"},[s._v("42")]),a("br"),a("span",{staticClass:"line-number"},[s._v("43")]),a("br"),a("span",{staticClass:"line-number"},[s._v("44")]),a("br"),a("span",{staticClass:"line-number"},[s._v("45")]),a("br"),a("span",{staticClass:"line-number"},[s._v("46")]),a("br"),a("span",{staticClass:"line-number"},[s._v("47")]),a("br"),a("span",{staticClass:"line-number"},[s._v("48")]),a("br"),a("span",{staticClass:"line-number"},[s._v("49")]),a("br"),a("span",{staticClass:"line-number"},[s._v("50")]),a("br"),a("span",{staticClass:"line-number"},[s._v("51")]),a("br"),a("span",{staticClass:"line-number"},[s._v("52")]),a("br"),a("span",{staticClass:"line-number"},[s._v("53")]),a("br"),a("span",{staticClass:"line-number"},[s._v("54")]),a("br")])]),a("br"),s._v(" "),a("br"),s._v(" "),a("ClientOnly",[a("disqus-component"),s._v(" "),a("userway-component")],1)],1)}),[],!1,null,null,null);a.default=n.exports}}]);