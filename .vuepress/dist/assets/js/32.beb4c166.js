(window.webpackJsonp=window.webpackJsonp||[]).push([[32],{317:function(a,e,t){"use strict";t.r(e);var s=t(14),n=Object(s.a)({},(function(){var a=this,e=a._self._c;return e("ContentSlotsDistributor",{attrs:{"slot-key":a.$parent.slotKey}},[e("h2",{attrs:{id:"what-goes-into-a-maintenance-plan"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#what-goes-into-a-maintenance-plan"}},[a._v("#")]),a._v(" What goes into a Maintenance Plan?")]),a._v(" "),e("p",[a._v("Unlike many other kinds of technology which generally stay static unless a\nchange is intentionally applied, databases are always evolving and changing\nlike a living being. And like all things that are alive, they need care and\nmaintenance to stay productive and healthy.")]),a._v(" "),e("p",[a._v("Even for small databases, like those mandated by Express, database maintenance is a\nkey part of continuous performance and the proactive reduction of system errors. A standard\nmaintenance plan will address areas like:")]),a._v(" "),e("ul",[e("li",[a._v("Index rebuilds / reorganizations")]),a._v(" "),e("li",[a._v("Updating statistics")]),a._v(" "),e("li",[a._v("Backing up the database")]),a._v(" "),e("li",[a._v("Cleaning old backup files")]),a._v(" "),e("li",[a._v("Purging unnecessary data\n"),e("ul",[e("li",[a._v("System Data")]),a._v(" "),e("li",[a._v("Application Data")])])])]),a._v(" "),e("h2",{attrs:{id:"best-maintenance-plan-practices-for-sql-server-express"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#best-maintenance-plan-practices-for-sql-server-express"}},[a._v("#")]),a._v(" Best Maintenance Plan Practices for SQL Server Express")]),a._v(" "),e("p",[a._v("For the most part, maintenance on database of 10GB or less is straightforward. Most\nsystems are able to do index maintenance, update statistics, and purge old data extremely\nquickly on a data set of this size. The size restriction removes many potentially complicated\nscenarios where jobs must be run on individual partitions, by filegroups, or staggered across\ndifferent days of the week.")]),a._v(" "),e("p",[a._v("Since SQL Server Express doesn't have SQL Agent, and thus doesn't have the GUI-focused\nmaintenance plan feature at all, maintenance must be achieved using T-SQL. Luckily, most seasoned\nDBAs agree that T-SQL based maintenance plans are better than their GUI counterparts,\nso general SQL Server best practices are applicable to Express.")]),a._v(" "),e("h3",{attrs:{id:"ola-s-maintenance-scripts"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#ola-s-maintenance-scripts"}},[a._v("#")]),a._v(" Ola's Maintenance Scripts")]),a._v(" "),e("p",[a._v("Just as "),e("a",{attrs:{href:"https://ola.hallengren.com/sql-server-backup.html",target:"_blank",rel:"noopener noreferrer"}},[a._v("Ola Hallengrens free scripts"),e("OutboundLink")],1),a._v(" are highly recommended for "),e("RouterLink",{attrs:{to:"/sql-server-express-backups.html"}},[a._v("SQL Express backups")]),a._v(", the same goes for his index and statistic scripts which help to make managing both areas extremely easy and customizable.")],1),a._v(" "),e("p",[a._v("By default, Ola's scripts use the following settings:")]),a._v(" "),e("div",{staticClass:"language-sql line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-sql"}},[e("code",[e("span",{pre:!0,attrs:{class:"token variable"}},[a._v("@FragmentationMedium")]),a._v(" nvarchar"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("(")]),a._v("max"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(")")]),a._v(" "),e("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),a._v(" "),e("span",{pre:!0,attrs:{class:"token string"}},[a._v("'INDEX_REORGANIZE,INDEX_REBUILD_ONLINE,INDEX_REBUILD_OFFLINE'")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(",")]),a._v("\n"),e("span",{pre:!0,attrs:{class:"token variable"}},[a._v("@FragmentationHigh")]),a._v(" nvarchar"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("(")]),a._v("max"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(")")]),a._v(" "),e("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),a._v(" "),e("span",{pre:!0,attrs:{class:"token string"}},[a._v("'INDEX_REBUILD_ONLINE,INDEX_REBUILD_OFFLINE'")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(",")]),a._v("\n"),e("span",{pre:!0,attrs:{class:"token variable"}},[a._v("@FragmentationLevel1")]),a._v(" "),e("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("int")]),a._v(" "),e("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),a._v(" "),e("span",{pre:!0,attrs:{class:"token number"}},[a._v("5")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(",")]),a._v("\n"),e("span",{pre:!0,attrs:{class:"token variable"}},[a._v("@FragmentationLevel2")]),a._v(" "),e("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("int")]),a._v(" "),e("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),a._v(" "),e("span",{pre:!0,attrs:{class:"token number"}},[a._v("30")]),a._v("\n")])]),a._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[a._v("1")]),e("br"),e("span",{staticClass:"line-number"},[a._v("2")]),e("br"),e("span",{staticClass:"line-number"},[a._v("3")]),e("br"),e("span",{staticClass:"line-number"},[a._v("4")]),e("br")])]),e("p",[a._v("These translate to nothing being done to an index that is less than 5% fragmented;\nan attempt to reorganize, rebuild online, and rebuild offline (in that order) indexes fragmented more\nthan 5% but less than 30%; an attempt to rebuild online and rebuild offline (in that order)\nif fragmentation is greater than 30%. Subsequent maintenance actions are only tried if the\none before is unavailable or not supported on an index. For SQL Server Express, online index rebuilds\nare not available, so this option will always be skipped if not removed.")]),a._v(" "),e("p",[a._v("These numbers are based off of Microsoft's BOL article "),e("a",{attrs:{href:"https://docs.microsoft.com/en-us/sql/relational-databases/indexes/reorganize-and-rebuild-indexes",target:"_blank",rel:"noopener noreferrer"}},[a._v("Reorganize and Rebuild Indexes"),e("OutboundLink")],1),a._v(". Though that article may "),e("em",[a._v("look")]),a._v(" new and shiny, most of its contents are from a many years ago and most aspects (like fragmentation thresholds) have never been updated. With that in mind, some higher thresholds than the default are not only acceptable, but encouraged.")]),a._v(" "),e("p",[a._v("A more modern take is setting the first fragmentation level to 30% and the second level to 80%. Some even\nprefer to go higher (see further reading at the bottom). Adjusting Ola's defaults, by taking into consideration the lack of an online rebuild option and taking advantage of a few extra settings results in the following recommended script:")]),a._v(" "),e("div",{staticClass:"language-sql line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-sql"}},[e("code",[e("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("EXECUTE")]),a._v(" dbo"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(".")]),a._v("IndexOptimize\n"),e("span",{pre:!0,attrs:{class:"token variable"}},[a._v("@Databases")]),a._v(" "),e("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),a._v(" "),e("span",{pre:!0,attrs:{class:"token string"}},[a._v("'USER_DATABASES'")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(",")]),a._v("\n"),e("span",{pre:!0,attrs:{class:"token variable"}},[a._v("@FragmentationLow")]),a._v(" "),e("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),a._v(" "),e("span",{pre:!0,attrs:{class:"token boolean"}},[a._v("NULL")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(",")]),a._v("\n"),e("span",{pre:!0,attrs:{class:"token variable"}},[a._v("@FragmentationMedium")]),a._v(" "),e("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),a._v(" "),e("span",{pre:!0,attrs:{class:"token string"}},[a._v("'INDEX_REORGANIZE,INDEX_REBUILD_OFFLINE'")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(",")]),a._v("\n"),e("span",{pre:!0,attrs:{class:"token variable"}},[a._v("@FragmentationHigh")]),a._v(" "),e("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),a._v(" "),e("span",{pre:!0,attrs:{class:"token string"}},[a._v("'INDEX_REBUILD_OFFLINE'")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(",")]),a._v("\n"),e("span",{pre:!0,attrs:{class:"token variable"}},[a._v("@FragmentationLevel1")]),a._v(" "),e("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),a._v(" "),e("span",{pre:!0,attrs:{class:"token number"}},[a._v("30")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(",")]),a._v("\n"),e("span",{pre:!0,attrs:{class:"token variable"}},[a._v("@FragmentationLevel2")]),a._v(" "),e("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),a._v(" "),e("span",{pre:!0,attrs:{class:"token number"}},[a._v("80")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(",")]),a._v("\n"),e("span",{pre:!0,attrs:{class:"token variable"}},[a._v("@SortInTempdb")]),a._v(" "),e("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),a._v(" "),e("span",{pre:!0,attrs:{class:"token string"}},[a._v("'Y'")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(",")]),a._v("\n"),e("span",{pre:!0,attrs:{class:"token variable"}},[a._v("@FillFactor")]),a._v(" "),e("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),a._v(" "),e("span",{pre:!0,attrs:{class:"token number"}},[a._v("100")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(",")]),a._v("\n"),e("span",{pre:!0,attrs:{class:"token variable"}},[a._v("@UpdateStatistics")]),a._v(" "),e("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),a._v(" "),e("span",{pre:!0,attrs:{class:"token string"}},[a._v("'Y'")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(",")]),a._v("\n"),e("span",{pre:!0,attrs:{class:"token variable"}},[a._v("@OnlyModifiedStatistics")]),a._v(" "),e("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),a._v(" "),e("span",{pre:!0,attrs:{class:"token string"}},[a._v("'Y'")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(",")]),a._v("\n"),e("span",{pre:!0,attrs:{class:"token variable"}},[a._v("@Indexes")]),a._v(" "),e("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),a._v(" "),e("span",{pre:!0,attrs:{class:"token string"}},[a._v("'ALL_INDEXES'")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(",")]),a._v("\n"),e("span",{pre:!0,attrs:{class:"token variable"}},[a._v("@LogToTable")]),a._v(" "),e("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),a._v(" "),e("span",{pre:!0,attrs:{class:"token string"}},[a._v("'Y'")]),a._v("\n")])]),a._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[a._v("1")]),e("br"),e("span",{staticClass:"line-number"},[a._v("2")]),e("br"),e("span",{staticClass:"line-number"},[a._v("3")]),e("br"),e("span",{staticClass:"line-number"},[a._v("4")]),e("br"),e("span",{staticClass:"line-number"},[a._v("5")]),e("br"),e("span",{staticClass:"line-number"},[a._v("6")]),e("br"),e("span",{staticClass:"line-number"},[a._v("7")]),e("br"),e("span",{staticClass:"line-number"},[a._v("8")]),e("br"),e("span",{staticClass:"line-number"},[a._v("9")]),e("br"),e("span",{staticClass:"line-number"},[a._v("10")]),e("br"),e("span",{staticClass:"line-number"},[a._v("11")]),e("br"),e("span",{staticClass:"line-number"},[a._v("12")]),e("br"),e("span",{staticClass:"line-number"},[a._v("13")]),e("br")])]),e("h4",{attrs:{id:"fragmentation"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#fragmentation"}},[a._v("#")]),a._v(" Fragmentation")]),a._v(" "),e("p",[a._v("Since taking an index offline for a rebuild isn't ideal, 80% makes sure that scenario isn't\noccurring too often.")]),a._v(" "),e("h4",{attrs:{id:"fill-factor"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#fill-factor"}},[a._v("#")]),a._v(" Fill Factor")]),a._v(" "),e("p",[a._v("While normally a fill factor might need to be tweaked, it is\nprobably safe to keep at 100% (no padding in the index) to make sure that the database\nfiles aren't hitting the 10GB limit earlier than is absolutely necessary.")]),a._v(" "),e("h4",{attrs:{id:"update-statistics"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#update-statistics"}},[a._v("#")]),a._v(" Update statistics")]),a._v(" "),e("p",[a._v("One of the great features of Ola's script is that it will update statistics after it\ndoes the index rebuilds, since an index maintenance operation will automatically\nupdate statistics in use by the index. This prevents duplication of work and\nunnecessary transactions. Using the "),e("code",[a._v("@OnlyModifiedStatistics")]),a._v(" flag further helps further by checking if a table's data has been altered since the last time\nstatistics were updated. If the table hasn't changed, then there is no reason to change\nthe statistics and it is skipped. This is especially helpful for archive tables or enum tables that\nhardly or ever change, but may take up significant time to do statistics samplings on.")]),a._v(" "),e("h4",{attrs:{id:"logging"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#logging"}},[a._v("#")]),a._v(" Logging")]),a._v(" "),e("p",[a._v("Logging to the built-in table is extremely useful when tracking down a failed index job or\nto analyze a growing trend in job runtime. It doesn't cost much to log each action,\nbut is key when hunting down problems with maintenance jobs.")]),a._v(" "),e("h3",{attrs:{id:"other-maintenance-tasks"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#other-maintenance-tasks"}},[a._v("#")]),a._v(" Other Maintenance Tasks")]),a._v(" "),e("p",[a._v("Backup pruning is conveniently handled by settings within Ola's script, so that part of\nmaintenance can be bundled right into the backup commands themselves (see the "),e("RouterLink",{attrs:{to:"/best-practices/sql-server-express-backups/"}},[a._v("Express Backup")]),a._v(") article for details.")],1),a._v(" "),e("p",[a._v("Data pruning is highly specific to an individual database's needs, so usually needs to be\ndeveloper a la carte. If you need help figuring this out for your databases, feel free to\nreach out via the "),e("RouterLink",{attrs:{to:"/author/contact/"}},[a._v("contact page")]),a._v(" to get more one-on-one help.")],1),a._v(" "),e("h2",{attrs:{id:"further-reading"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#further-reading"}},[a._v("#")]),a._v(" Further Reading")]),a._v(" "),e("ul",[e("li",[a._v("Brent Ozar's "),e("a",{attrs:{href:"https://www.brentozar.com/archive/2014/12/tweaking-defaults-ola-hallengrens-maintenance-scripts/",target:"_blank",rel:"noopener noreferrer"}},[a._v("Tweaking the Defaults for Ola Hallengren’s Maintenance Scripts"),e("OutboundLink")],1)]),a._v(" "),e("li",[a._v("RedGate's "),e("a",{attrs:{href:"https://www.red-gate.com/simple-talk/sql/database-administration/automate-and-improve-your-database-maintenance-using-ola-hallengrens-free-script/",target:"_blank",rel:"noopener noreferrer"}},[a._v("Automate and Improve Your Database Maintennace Using Ola Hallengren's Free Script"),e("OutboundLink")],1)])]),a._v(" "),e("br"),a._v(" "),e("br"),a._v(" "),e("ClientOnly",[e("disqus-component"),a._v(" "),e("userway-component")],1)],1)}),[],!1,null,null,null);e.default=n.exports}}]);