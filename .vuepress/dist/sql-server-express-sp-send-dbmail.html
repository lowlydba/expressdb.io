<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Mail without SQL Agent | Express DB</title>
    <meta name="generator" content="VuePress 1.9.10">
    <link rel="icon" href="/favicon.png">
    <meta name="description" content="">
    <meta property="og:locale" content="en_US">
    <meta property="og:type" content="website">
    <meta property="og:site_name" content="Express DB">
    <meta property="og:title" content="Express DB">
    <meta property="og:description" content="Guides and references for SQL Server Express">
    <meta property="og:image" content="/expressdb-og.png">
    <meta property="twitter:card" content="summary">
    <meta property="twitter:domain" content="expressdb.io">
    <meta property="twitter:url" content="https://expressdb.io">
    <meta property="twitter:title" content="Express DB">
    <meta property="twitter:description" content="Guides and references for SQL Server Express">
    <meta property="twitter:image" content="/expressdb-og.png">
    
    <link rel="preload" href="/assets/css/styles.styles.e54519bf.css" as="style"><link rel="preload" href="/assets/js/app.509b06de.js" as="script"><link rel="preload" href="/assets/js/4.1ced6ee8.js" as="script"><link rel="preload" href="/assets/js/2.8d2218f9.js" as="script"><link rel="preload" href="/assets/js/0.bc9361a5.js" as="script"><link rel="preload" href="/assets/js/1.85b66b62.js" as="script"><link rel="preload" href="/assets/js/3.db97c658.js" as="script"><link rel="preload" href="/assets/js/33.86ac69a4.js" as="script"><link rel="prefetch" href="/assets/js/10.2f46c8ae.js"><link rel="prefetch" href="/assets/js/11.9b735235.js"><link rel="prefetch" href="/assets/js/12.b0f4915c.js"><link rel="prefetch" href="/assets/js/13.3eb7cac0.js"><link rel="prefetch" href="/assets/js/14.3f360647.js"><link rel="prefetch" href="/assets/js/15.ad165653.js"><link rel="prefetch" href="/assets/js/16.5f2fb8e0.js"><link rel="prefetch" href="/assets/js/17.11264fc4.js"><link rel="prefetch" href="/assets/js/18.d532bc9d.js"><link rel="prefetch" href="/assets/js/19.7724ac9b.js"><link rel="prefetch" href="/assets/js/20.22678f92.js"><link rel="prefetch" href="/assets/js/21.7472766f.js"><link rel="prefetch" href="/assets/js/22.b71fa0ce.js"><link rel="prefetch" href="/assets/js/23.f2b9322f.js"><link rel="prefetch" href="/assets/js/24.18af09c0.js"><link rel="prefetch" href="/assets/js/25.c3666c6c.js"><link rel="prefetch" href="/assets/js/26.206e19e0.js"><link rel="prefetch" href="/assets/js/27.0c58409c.js"><link rel="prefetch" href="/assets/js/28.54320c77.js"><link rel="prefetch" href="/assets/js/29.f71a95ef.js"><link rel="prefetch" href="/assets/js/30.e1d8001b.js"><link rel="prefetch" href="/assets/js/31.cd315b41.js"><link rel="prefetch" href="/assets/js/32.501a92ae.js"><link rel="prefetch" href="/assets/js/34.6b21cc29.js"><link rel="prefetch" href="/assets/js/35.4144ce46.js"><link rel="prefetch" href="/assets/js/36.ac4246d6.js"><link rel="prefetch" href="/assets/js/37.a7053644.js"><link rel="prefetch" href="/assets/js/38.02123d7c.js"><link rel="prefetch" href="/assets/js/39.9e78590c.js"><link rel="prefetch" href="/assets/js/40.63df069f.js"><link rel="prefetch" href="/assets/js/5.4958dcf1.js"><link rel="prefetch" href="/assets/js/6.a8595bc3.js"><link rel="prefetch" href="/assets/js/7.5eec8add.js"><link rel="prefetch" href="/assets/js/8.d6b6ac95.js"><link rel="prefetch" href="/assets/js/9.6c4d4ee0.js"><link rel="prefetch" href="/assets/js/vendors~docsearch.ec314fa4.js">
    <link rel="stylesheet" href="/assets/css/styles.styles.e54519bf.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/" class="home-link router-link-active"><!----> <span class="site-name">Express DB</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/" class="nav-link">
  Home
</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="Guides Menu" class="dropdown-title"><span class="title">Guides</span> <span class="arrow down"></span></button> <button type="button" aria-label="Guides Menu" class="mobile-dropdown-title"><span class="title">Guides</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/what-is-sql-server-express.html" class="nav-link">
  What is SQL Server Express?
</a></li><li class="dropdown-item"><!----> <a href="/sql-server-express-feature-comparison.html" class="nav-link">
  Express vs. Standard vs. Enterprise
</a></li><li class="dropdown-item"><!----> <a href="/sql-server-express-vs-localdb.html" class="nav-link">
  SQL Express vs. LocalDB
</a></li><li class="dropdown-item"><!----> <a href="/which-sql-server-express-version-to-use.html" class="nav-link">
  Which Express Version to Use
</a></li><li class="dropdown-item"><!----> <a href="/which-sql-server-management-studio-version.html" class="nav-link">
  Which Management Studio to Use
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="Limitations Menu" class="dropdown-title"><span class="title">Limitations</span> <span class="arrow down"></span></button> <button type="button" aria-label="Limitations Menu" class="mobile-dropdown-title"><span class="title">Limitations</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/sql-server-express-database-size-limit.html" class="nav-link">
  Size Restrictions
</a></li><li class="dropdown-item"><!----> <a href="/sql-server-express-hardware-limitations.html" class="nav-link">
  Hardware Restrictions
</a></li><li class="dropdown-item"><!----> <a href="/sql-server-express-sp-send-dbmail.html" aria-current="page" class="nav-link router-link-exact-active router-link-active">
  Missing Database Mail
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="Best Practices Menu" class="dropdown-title"><span class="title">Best Practices</span> <span class="arrow down"></span></button> <button type="button" aria-label="Best Practices Menu" class="mobile-dropdown-title"><span class="title">Best Practices</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/sql-server-express-backups.html" class="nav-link">
  Backups
</a></li><li class="dropdown-item"><!----> <a href="/sql-server-express-maintenance.html" class="nav-link">
  Maintenance
</a></li><li class="dropdown-item"><!----> <a href="/sql-server-express-security-best-practices.html" class="nav-link">
  Security
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="Automation Menu" class="dropdown-title"><span class="title">Automation</span> <span class="arrow down"></span></button> <button type="button" aria-label="Automation Menu" class="mobile-dropdown-title"><span class="title">Automation</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/sql-server-express-replace-sql-agent.html" class="nav-link">
  Replacing SQL Agent
</a></li><li class="dropdown-item"><!----> <a href="/sql-server-express-unattended-install.html" class="nav-link">
  Unattended Installation
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="Free Tools Menu" class="dropdown-title"><span class="title">Tools &amp; Resources</span> <span class="arrow down"></span></button> <button type="button" aria-label="Free Tools Menu" class="mobile-dropdown-title"><span class="title">Tools &amp; Resources</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/sql-server-resources.html" class="nav-link">
  Scripts, Apps, and Resources
</a></li><li class="dropdown-item"><!----> <a href="https://dba-multitool.org" target="_blank" rel="noopener noreferrer" class="nav-link external">
  DBA MultiTool
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li><li class="dropdown-item"><!----> <a href="/azure-data-studio.html" class="nav-link">
  Azure Data Studio
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="Author Menu" class="dropdown-title"><span class="title">Author</span> <span class="arrow down"></span></button> <button type="button" aria-label="Author Menu" class="mobile-dropdown-title"><span class="title">Author</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/about.html" class="nav-link">
  About
</a></li><li class="dropdown-item"><!----> <a href="/contact.html" class="nav-link">
  Contact
</a></li></ul></div></div> <a href="https://github.com/LowlyDBA/expressdb" target="_blank" rel="noopener noreferrer" class="repo-link">
    Contribute!
    <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/" class="nav-link">
  Home
</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="Guides Menu" class="dropdown-title"><span class="title">Guides</span> <span class="arrow down"></span></button> <button type="button" aria-label="Guides Menu" class="mobile-dropdown-title"><span class="title">Guides</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/what-is-sql-server-express.html" class="nav-link">
  What is SQL Server Express?
</a></li><li class="dropdown-item"><!----> <a href="/sql-server-express-feature-comparison.html" class="nav-link">
  Express vs. Standard vs. Enterprise
</a></li><li class="dropdown-item"><!----> <a href="/sql-server-express-vs-localdb.html" class="nav-link">
  SQL Express vs. LocalDB
</a></li><li class="dropdown-item"><!----> <a href="/which-sql-server-express-version-to-use.html" class="nav-link">
  Which Express Version to Use
</a></li><li class="dropdown-item"><!----> <a href="/which-sql-server-management-studio-version.html" class="nav-link">
  Which Management Studio to Use
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="Limitations Menu" class="dropdown-title"><span class="title">Limitations</span> <span class="arrow down"></span></button> <button type="button" aria-label="Limitations Menu" class="mobile-dropdown-title"><span class="title">Limitations</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/sql-server-express-database-size-limit.html" class="nav-link">
  Size Restrictions
</a></li><li class="dropdown-item"><!----> <a href="/sql-server-express-hardware-limitations.html" class="nav-link">
  Hardware Restrictions
</a></li><li class="dropdown-item"><!----> <a href="/sql-server-express-sp-send-dbmail.html" aria-current="page" class="nav-link router-link-exact-active router-link-active">
  Missing Database Mail
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="Best Practices Menu" class="dropdown-title"><span class="title">Best Practices</span> <span class="arrow down"></span></button> <button type="button" aria-label="Best Practices Menu" class="mobile-dropdown-title"><span class="title">Best Practices</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/sql-server-express-backups.html" class="nav-link">
  Backups
</a></li><li class="dropdown-item"><!----> <a href="/sql-server-express-maintenance.html" class="nav-link">
  Maintenance
</a></li><li class="dropdown-item"><!----> <a href="/sql-server-express-security-best-practices.html" class="nav-link">
  Security
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="Automation Menu" class="dropdown-title"><span class="title">Automation</span> <span class="arrow down"></span></button> <button type="button" aria-label="Automation Menu" class="mobile-dropdown-title"><span class="title">Automation</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/sql-server-express-replace-sql-agent.html" class="nav-link">
  Replacing SQL Agent
</a></li><li class="dropdown-item"><!----> <a href="/sql-server-express-unattended-install.html" class="nav-link">
  Unattended Installation
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="Free Tools Menu" class="dropdown-title"><span class="title">Tools &amp; Resources</span> <span class="arrow down"></span></button> <button type="button" aria-label="Free Tools Menu" class="mobile-dropdown-title"><span class="title">Tools &amp; Resources</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/sql-server-resources.html" class="nav-link">
  Scripts, Apps, and Resources
</a></li><li class="dropdown-item"><!----> <a href="https://dba-multitool.org" target="_blank" rel="noopener noreferrer" class="nav-link external">
  DBA MultiTool
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li><li class="dropdown-item"><!----> <a href="/azure-data-studio.html" class="nav-link">
  Azure Data Studio
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="Author Menu" class="dropdown-title"><span class="title">Author</span> <span class="arrow down"></span></button> <button type="button" aria-label="Author Menu" class="mobile-dropdown-title"><span class="title">Author</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/about.html" class="nav-link">
  About
</a></li><li class="dropdown-item"><!----> <a href="/contact.html" class="nav-link">
  Contact
</a></li></ul></div></div> <a href="https://github.com/LowlyDBA/expressdb" target="_blank" rel="noopener noreferrer" class="repo-link">
    Contribute!
    <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></nav>  <ul class="sidebar-links"><li><section class="sidebar-group depth-0"><p class="sidebar-heading open"><span>Mail without SQL Agent</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/sql-server-express-sp-send-dbmail.html#mail-without-sql-agent" class="sidebar-link">Mail without SQL Agent</a><ul class="sidebar-sub-headers"></ul></li><li><a href="/sql-server-express-sp-send-dbmail.html#setting-up-mail-on-sql-server-express" class="sidebar-link">Setting up Mail on SQL Server Express</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/sql-server-express-sp-send-dbmail.html#the-code" class="sidebar-link">The Code</a></li></ul></li></ul></section></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h2 id="mail-without-sql-agent"><a href="#mail-without-sql-agent" class="header-anchor">#</a> Mail without SQL Agent</h2> <p>While SQL Server Express is still 100% able to send mail using msdb's stored procedures,
most people rely on Management Studio's GUI and the Database Mail feature to do the initial setup of profiles and accounts
to make sending mail possible. Despite this limitation, the underlying stored procedures located within the msdb database are still fully able to replication the GUI driven setup that Database Mail aids in. This leaves T-SQL as the primary alternative for enabling and configuring SQL Server Express so that <code>sp_send_dbmail</code> can be used to send mail out. Adding this functionality with a <a href="/sql-server-express-replace-sql-agent.html">replacement for SQL Agent</a> can help mimic much of the functionality that Database Mail and SQL Agent provide on the full featured editions of SQL Server.</p> <p><img src="/database_mail.png" alt="SQL Server Mail in non-Express Editions"></p> <p><em>The Database Mail feature as seen in other SQL Server editions.</em></p> <p>While a CLR can also be used to send mail, that route is far more work and increases the complexity of
sending mail via SQL Server quite a bit. This requires enabling CLRs, which is disabled by default. Enabling CLRs opens the instance up to external code, which may be a security or audit concern and is often allowed in many corporate environments.</p> <h2 id="setting-up-mail-on-sql-server-express"><a href="#setting-up-mail-on-sql-server-express" class="header-anchor">#</a> Setting up Mail on SQL Server Express</h2> <p>The below code sample demonstrates the entire process of setting up mail on SQL Server Express,
including sending a test email at the end.</p> <div class="custom-block warning"><p class="custom-block-title">WARNING</p> <p>Utilizing the database mail on SQL Server Express Edition may violate the license agreement. Check with Microsoft before implementing this in a production environment.</p></div> <p>The setup will:</p> <ol><li>Create a mail account</li> <li>Create a mail profile</li> <li>Add the account to the profile</li> <li>Add permission to use the profile for a user or role</li> <li>Enable database mail XPs</li> <li>Send a test email</li></ol> <p>The stored procedures required are:</p> <ul><li><a href="https://docs.microsoft.com/en-us/sql/relational-databases/system-stored-procedures/sysmail-add-account-sp-transact-sql?view=sql-server-2017" target="_blank" rel="noopener noreferrer">sysmail_add_account_sp<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li> <li><a href="https://docs.microsoft.com/en-us/sql/relational-databases/system-stored-procedures/sysmail-add-profile-sp-transact-sql?view=sql-server-2017" target="_blank" rel="noopener noreferrer">sysmail_add_profile_sp<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li> <li><a href="https://docs.microsoft.com/en-us/sql/relational-databases/system-stored-procedures/sysmail-add-profileaccount-sp-transact-sql?view=sql-server-2017" target="_blank" rel="noopener noreferrer">sysmail_add_profileaccount_sp<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li> <li><a href="https://docs.microsoft.com/en-us/sql/relational-databases/system-stored-procedures/sysmail-add-principalprofile-sp-transact-sql?view=sql-server-2017" target="_blank" rel="noopener noreferrer">sysmail_add_principalprofile_sp<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li> <li><a href="https://docs.microsoft.com/en-us/sql/relational-databases/system-stored-procedures/sp-configure-transact-sql?view=sql-server-2017" target="_blank" rel="noopener noreferrer">sp_configure<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li> <li><a href="https://docs.microsoft.com/en-us/sql/relational-databases/system-stored-procedures/sp-send-dbmail-transact-sql?view=sql-server-2017" target="_blank" rel="noopener noreferrer">sp_send_dbmail<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li></ul> <h3 id="the-code"><a href="#the-code" class="header-anchor">#</a> The Code</h3> <div class="language-sql line-numbers-mode"><pre class="language-sql"><code><span class="token comment">/* Create a mail account */</span>
<span class="token keyword">EXECUTE</span> msdb<span class="token punctuation">.</span>dbo<span class="token punctuation">.</span>sysmail_add_account_sp
<span class="token variable">@account_name</span> <span class="token operator">=</span> <span class="token string">'MyMailAccount'</span><span class="token punctuation">,</span>
<span class="token variable">@description</span> <span class="token operator">=</span> <span class="token string">'Used for sending email from SQL Express'</span><span class="token punctuation">,</span>
<span class="token comment">--Name of sending email address</span>
<span class="token variable">@email_address</span> <span class="token operator">=</span> <span class="token string">'MyExpressDB@mycompany.com'</span><span class="token punctuation">,</span>
<span class="token comment">--Display name for the sending email address</span>
<span class="token variable">@display_name</span> <span class="token operator">=</span> <span class="token string">'MyExpressDB'</span><span class="token punctuation">,</span>
<span class="token comment">--Username to login to the mail server</span>
<span class="token variable">@username</span><span class="token operator">=</span><span class="token string">'MyMailUser@mycompany.com'</span><span class="token punctuation">,</span>
<span class="token comment">--Password to login to the mail server</span>
<span class="token variable">@password</span><span class="token operator">=</span><span class="token string">'MyPassword'</span><span class="token punctuation">,</span>
<span class="token comment">--Name or IP of the mail server</span>
<span class="token variable">@mailserver_name</span> <span class="token operator">=</span> <span class="token string">'mail.queryingsql.com'</span>
<span class="token comment">--Default is 25, or specify a custom one</span>
<span class="token variable">@port</span> <span class="token operator">=</span> <span class="token number">25</span><span class="token punctuation">;</span>

<span class="token comment">/* Create a profile */</span>
<span class="token keyword">EXECUTE</span> msdb<span class="token punctuation">.</span>dbo<span class="token punctuation">.</span>sysmail_add_profile_sp
<span class="token variable">@profile_name</span> <span class="token operator">=</span> <span class="token string">'MyMailProfile'</span><span class="token punctuation">,</span>
<span class="token variable">@description</span> <span class="token operator">=</span> <span class="token string">'Main profile used to send email'</span><span class="token punctuation">;</span>

<span class="token comment">/* Add the account to the profile */</span>
<span class="token keyword">EXECUTE</span> msdb<span class="token punctuation">.</span>dbo<span class="token punctuation">.</span>sysmail_add_profileaccount_sp
<span class="token variable">@profile_name</span> <span class="token operator">=</span> <span class="token string">'MyMailProfile'</span><span class="token punctuation">,</span>
<span class="token variable">@account_name</span> <span class="token operator">=</span> <span class="token string">'MyMailAccount'</span><span class="token punctuation">,</span>
<span class="token comment">/* The sequence number determines the order
in which Database Mail uses accounts in the profile,
going from lowest to highest until one works. */</span>
<span class="token variable">@sequence_number</span> <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span>

<span class="token comment">/* Grant permission to public to use the profile
or choose a more restrictive group if desired */</span>
<span class="token keyword">EXECUTE</span> msdb<span class="token punctuation">.</span>dbo<span class="token punctuation">.</span>sysmail_add_principalprofile_sp
<span class="token variable">@profile_name</span> <span class="token operator">=</span> <span class="token string">'MyMailProfile'</span><span class="token punctuation">,</span>
<span class="token variable">@principal_name</span> <span class="token operator">=</span> <span class="token string">'public'</span><span class="token punctuation">,</span>
<span class="token variable">@is_default</span> <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span>

<span class="token comment">/* Enable Mail XPs */</span>
<span class="token keyword">EXECUTE</span> sp_configure <span class="token string">'show advanced options'</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">;</span>
GO
<span class="token keyword">RECONFIGURE</span><span class="token punctuation">;</span>
GO
<span class="token keyword">EXECUTE</span> sp_configure <span class="token string">'Database Mail XPs'</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">;</span>
GO
<span class="token keyword">RECONFIGURE</span><span class="token punctuation">;</span>
GO

<span class="token comment">/* Send a test email */</span>
<span class="token keyword">EXECUTE</span> msdb<span class="token punctuation">.</span>dbo<span class="token punctuation">.</span>sp_send_dbmail
<span class="token variable">@profile_name</span> <span class="token operator">=</span> <span class="token string">'MyMailProfile'</span><span class="token punctuation">,</span>
<span class="token variable">@recipients</span> <span class="token operator">=</span> <span class="token string">'MyTestAddress@mycompany.com'</span><span class="token punctuation">,</span>
<span class="token variable">@subject</span> <span class="token operator">=</span> <span class="token string">'Test Mail from SQL Express'</span><span class="token punctuation">,</span>
<span class="token variable">@body</span> <span class="token operator">=</span> <span class="token string">'Hello world!'</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br><span class="line-number">46</span><br><span class="line-number">47</span><br><span class="line-number">48</span><br><span class="line-number">49</span><br><span class="line-number">50</span><br><span class="line-number">51</span><br><span class="line-number">52</span><br><span class="line-number">53</span><br><span class="line-number">54</span><br></div></div><br> <br> <!----></div> <footer class="page-edit"><div class="edit-link"><a href="https://github.com/LowlyDBA/expressdb.io/edit/master//sql-server-express-sp-send-dbmail.md" target="_blank" rel="noopener noreferrer">Edit this page on Github</a> <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></div> <div class="last-updated"><span class="prefix">Last Updated:</span> <span class="time">12/19/2020, 6:04:33 PM</span></div></footer> <!----> </main></div><div class="global-ui"></div></div>
    <script src="/assets/js/app.509b06de.js" defer></script><script src="/assets/js/4.1ced6ee8.js" defer></script><script src="/assets/js/2.8d2218f9.js" defer></script><script src="/assets/js/0.bc9361a5.js" defer></script><script src="/assets/js/1.85b66b62.js" defer></script><script src="/assets/js/3.db97c658.js" defer></script><script src="/assets/js/33.86ac69a4.js" defer></script>
  </body>
</html>
